<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Circos plot- by Matt Ralston</title>
		<script type="text/javascript" src="d3/d3.v3.js"></script>
		<link rel="stylesheet" href="css/foundation.css"/>
		<style type="text/css">
		  #tooltip {
		  position: absolute;
		  width: 200px;
		  height: autopx;
		  padding: 10px;
		  background-color: white;
		  -webkit-border-radius: 10px;
		  -moz-border-radius: 10px;
		  border-radius: 10px;
		  -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
		  -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
		  box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
		  pointer-events: none;
		  }
		  #tooltip.hidden {
		  display: none;
		  }
		  #tooltip p {
		  margin: 0;
		  font-family: sans-serif;
		  font-size: 16px;
		  line-height: 20px;
		  }
		  path {
		   fill-opacity: .9;
		  }
		  path.hidden {
		   fill: #ccc !important;
		   fill-opacity: .1;
		   stroke: #fff;
		   display: none;
		  }
		</style>
	</head>
	<body>
	  <div id="Description">
	    <p><strong>Interactive visualization of RNA-seq data</strong></p>
	    <p>This visualization describes RNA sequencing data from my experiment. Bacterial cultures were stressed with butanol and butyrate during mid-exponential growth. Samples were collected at four time points.
	  </div>
	  <div id="viz"></div>
	  <div id="tooltip" class="hidden">
	    <p><strong>Selected point</strong></p>
	    <p><span id="value"></span></p>
	  </div>
		<script type="text/javascript">
			// Your beautiful D3 code will go here
			//d3.xml("https://www.dropbox.com/s/em3hxntuuojqfoc/circos.svg?dl=1","image/svg+xml",function(error,xml) {
		        d3.xml("circos.svg",function(error,xml) {
			if (error) {console.log(error)} // Log errors

			var importedNode = document.importNode(xml.documentElement, true);
			d3.select("#viz").node().appendChild(importedNode);
			var heatmaps = d3.selectAll(".heatmaps");
			var links = d3.selectAll(".links");
			var genes = d3.selectAll(".genelabels");
			var histograms = d3.selectAll(".histograms");
			// refers to or point
			var stroke
			var fill
			var genefill
			var genesize
			// M O U S E - O V E R 
			// Heatmaps
			heatmaps.selectAll("path").on("mouseover", function(d){heatin(d3.select(this))}).on("mouseout",function(d){ heatout(d3.select(this))})

			histograms.selectAll("circle").on("mouseover", function(d) {histin(d3.select(this))}).on("mouseout", function(d){histout(d3.select(this))})
			links.selectAll("path").on("mouseover",function(d) { var link=d3.select(this); if (!link.empty()) {linkin(link)}}).on("mouseout",function(d){ var link=d3.select(this);if (!link.empty()) {linkout(link)} })


			// M O U S E - F U N C T I O N S
			function linkin(link) {
			  var gene = d3.selectAll(".genelabels").select("text#"+link.attr("id"));
			  var cluster = link.attr("class");
			  links.selectAll("path").classed("hidden",true);
			  links.selectAll("."+cluster.split(" ")[0]).classed("hidden",false);
			  d3.select("#tooltip")
			  .style("left",(d3.event.pageX+10)+"px")
			  .style("top",(d3.event.pageY-10)+"px")
			  .style("width","750px").style("height","300px")
			  .select("#value")
			  .html("Labels: Gene ID = "+link.attr("id")+"<br/>Cluster = "+cluster);
			  d3.select("#tooltip").classed("hidden",false);
			  // overtime(d)
			}
			function histin(circle) {
			stroke = circle.style("stroke");
			fill = circle.style("fill");
			circle.classed("cell-hover",true);
			circle.style("stroke","red").attr("r","2.5").style("fill","red");
			d3.select("#tooltip")
			  .style("left",(d3.event.pageX+10) + "px")
			  .style("top",(d3.event.pageY-10) + "px")
			  .style("width","200px").style("height","300px")
			  .select("#value")
			  .html("labels: Coordinates = "+circle.attr("coord")+"<br/>Coverage = "+circle.attr("exp"));
			d3.select("#tooltip").classed("hidden",false);
			}
			function heatin(tile) {
			var link = d3.selectAll(".links").select("path#"+tile.attr("id"));
			var gene = d3.selectAll(".genelabels").select("text#"+tile.attr("id"));
			//console.log(link[0]);
			var cluster = (link.empty()) ? "NA" : link.attr("class");
			var w = 500;
			var h = 100;
			stroke = tile.style("stroke");
			fill = tile.style("fill");
			if (!gene.empty()) {
			  genefill = gene.attr("fill");
			  genesize = gene.attr("font-size");
			  gene.style("fill","red").attr("font-size","9.0px")
			}
			tile.classed("cell-hover",true);
			tile.style("stroke","red").attr("r","8.0").style("fill","red");

			d3.select("#tooltip")
			  .style("left", (d3.event.pageX+10) + "px")
			  .style("top", (d3.event.pageY-10) + "px")
			  .style("width","750px").style("height","300px")
			  .select("#value")
			  .html("labels: Gene ID = "+tile.attr("id")+"<br/>Comparison = "+tile.attr("cond")+"<br/>Log2 fold change = "+tile.attr("val")+"<br/>P-value = "+tile.attr("pval")+"<br/>Time = "+tile.attr("time")+"<br/>Cluster = "+cluster);
			d3.select("#tooltip").classed("hidden", false);
			// use .hidden class as in http://goo.gl/7Cx2ch
			// to make all links except those of interest hidden
			if (!link.empty()) {
			  d3.selectAll(".links path").classed("hidden",true);
			  d3.selectAll(".links").selectAll("."+link.attr("class").split(" ")[0]).classed("hidden",false);
			}
			// overtime(d)
			}
			function heatout(tile) {
			  var gene = d3.selectAll(".genelabels").select("text#"+tile.attr("id"));
			  d3.select("#tooltip").classed("hidden", true);
			  d3.select("#tooltip").select("svg").remove();
			  links.selectAll("path").classed("hidden",false);
			  gene.style("fill",genefill).attr("font-size",genesize);
			  
			  tile.transition().style("stroke",stroke).style("fill",fill);
			}
			function histout(circle) {
			d3.select("#tooltip").classed("hidden",true);
			circle.transition().style("stroke",stroke).style("fill",fill);
			}
			function linkout(link) {
			  d3.select("#tooltip").classed("hidden",true);
			  d3.select("#tooltip").select("svg").remove();
			  links.selectAll("path").classed("hidden",false);
			}
/*
			heatmaps.on("mouseover",function(d){
			var item = d3.select(this)
			var w = 500
			var h = 100
			stroke = item.style("stroke")
			fill = item.style("fill")
			// Make the 'dataset' consist of attributes from the circle
			var dataset = [item.attr("id"),item.attr("val")]
			var xScale = d3.scale.linear()
					     .domain([0,d3.max(dataset,function(d) {return d;})])
					     .range([0,w]);
*/

			//var rScale = d3.scale.linear().domain([0,d3.max(dataset,function(d) {return d;})]).range([2,5]);
/*
               //highlight the circle
               item.classed("cell-hover",true);
	       item.style("stroke", "red").attr("r","8.0").style("fill","red");
      
               //Update the tooltip position and value
               
	       // Draw an svg for graphing, to which other elements can be added
	       var minisvg = d3.select("#tooltip").append("svg")
		 .attr("width", w)
		 .attr("height", h);
	       // Make circles, bind the data
	       //var minicircles = minisvg.selectAll("circle")
		// .data(dataset)
		 //.enter()
		 //.append("circle");
	       // Make the circles properties reflect the data
	       //minicircles.attr("cx",function(d,i) { return (i * 50) + 25;})
		 //      .attr("cy",25)
		 //      .attr("r",function(d) {return rScale(d);});
               //Show the tooltip
               d3.select("#tooltip").classed("hidden", false);
        })
        .on("mouseout", function(d){
	       var item = d3.select(this)
               d3.select("#tooltip").classed("hidden", true);
	       d3.select("#tooltip").select("svg").remove();
	       item.transition().style("stroke",stroke).style("fill",fill);
*/
//        });


})




<!-- This section is devoted to the mouseover feature -->
                        
		</script>
	</body>
</html>
